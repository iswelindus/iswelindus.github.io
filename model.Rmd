---
title: "Model"
bibliography: bib_iswelindus.bib
link-citations: true
output:
  html_document:
    toc: true  
    toc_float: true 
---

# MESSAGEix Guides

The following user guides are available for the MESSAGEix framework and related models:

<ul>
<li> MESSAGEix IIASA private github repository: [https://github.com/iiasa/message_ix](https://github.com/iiasa/message_ix) </li>
<li> MESSAGEix Documentation User guide and ath formulation: [http://messageix.iiasa.ac.at/](http://messageix.iiasa.ac.at/) </li>

# Model features

## Regions



## Time horizon and time steps

The time horizon of the model goes from 1990 to 2060 with time steps of 10 year. However, also 2015 is included and the model is calibrated up to this year. Periods from 2020 onwards, are object of the optimization process that minimizes total system's costs.

To address seasonal variations, such as wet and dry seasons, months are considered in the model as an additional dimension for several variables.

## Technologies and Resources flows

The regional data are aggregated into subregions, or catchments (based on hydrogeological sub-basin borders, administrative regions and feedbacks during stakeholder engagement processes), each of them is considered as a node of the model.

Exchange of resources among nodes is modelled, as water flows through rivers and canals flows and electricty transmission lines.

Within each node, the MESSAGEix model tracks flows of commodities from insitu or local availability through different processes to a final exogenous demand. The list of sets, parameters, variables and equations are detailed in the subsequent sections. 

<p id="figcap"> Figure 2: ISWEL Indus Basin model breakdown</p>
<center>
<div id="fig">
![](figures\f_network_scheme.png)
</div>
</center>

<br><br>

## Technologies

### Energy sector
Several power plants have different cooling technologies, such as once through and closed loop freshwater cooling (*ot* and *cl* in the technology names), air cooling and sea water cooling (*ac* and *sw* respectively)

|  Technology  |  description  | 
|  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  |  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  | 
| gas_cc_ot, gas_cc_cl, gas_cc_ac, gas_cc_sw | Natural gas fired combined cycle |
| gas_st_ot, gas_st_cl, gas_st_ac, gas_st_sw | Natural gas fired steam turbine |
| gas_gt | Gas turbine |
| oil_cc_ot, oil_cc_cl, oil_cc_ac, oil_cc_sw | Oil fired combined cycle |
| oil_st_ot, oil_st_cl, oil_st_ac, oil_st_sw | Oil steam turbine|
| oil_gt | Oil turbine | 
| coal_st_ot, coal_st_cl, coal_st_ac, coal_st_sw | Coal fired steam turbine | 
| igcc_ot, igcc_cl, igcc_ac, igcc_sw | Coal fired integrated gasification combined cycle |
| nuclear_sw, nuclear_ot, nuclear_cl | Nuclear plant |
| geothermal_sw, geothermal_ot, geothermal_cl | Geothermal plant |
| biomass_st_ac, biomass_st_cl, biomass_st_sw | Biomass fired steam turbine |
| solar_pv_1, solar_pv_2, solar_pv_3 | Solar PV with different levels of capacity factor |
| wind_1, wind_2, wind_3 | Wind turbine with different levels of capacity factor |
| hydro_old | Existing hydroelectric power plants |
| hydro_river | New hydropower river technologies |
| hydro_canal | New hydro on small run-offs independent of upstream flow |
| electricity_distribution | Distribution grid potential within each region |
| trs_REG*_REG\* | Transmission grid capacity among regions |


### Water Technologies

|  Technology  |  description  | 
|  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  |  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  | 
|sw_extract| Surface water available for diversion|
|gw_extract| Groundwater available for diversion|
|urban_sw_diversion, rural_sw_diversion, irrigation_sw_diversion | Diversion of surface water |
|urban_gw_diversion, rural_gw_diversion, irrigation_gw_diversion | Diversion of groundwater |
|urban_piped_distribution, rural_piped_distribution| Water distribution through pipes |
|urban_unpiped_distribution, rural_unpiped_distribution| Unimproved water distribution |
|urban_wastewater_collection, rural_wastewater_collection | Water collection from treatment|
|urban_wastewater_release , rural_wastewater_release| water release into the river|
|urban_wastewater_treatment, rural_wastewater_treatment| Watewater treatment before returning to river|
|urban_wastewater_recycling, rural_wastewater_recycling| Water recycling for distribution |
|urban_desal_seawater | Desalination technology providing water for distribution| 
| river_REG*_REG\* | River surface water transfers among regions|
| river_REG*_REG\* | Canal surface water transfers among regions |



# Framework

The MESSAGEix Indus basin model is built using R to read input data from various formats including .txt, .csv, .xls, .nc and .shp files. With R, spatial data are aggregated according to the catchment level, parameters, sets and variable constraints are defined according to the GAMS formulation of the model. Then the model parametrization is loaded online as a scenario on the ix modelling platform. This allow to update and create new scenarios from existing ones, as well as solving the model with GAMS and visualizing some outputs.

<p id="figcap"> Figure 1: ISWEL Indus Basin model software</p>
<center>
<div id="fig">
![](figures\f_model_software.PNG)
</div>
</center>

<br><br>

The model is written in GAMS according to the MESSAGEix modelling framework, which code is open source and online at [https://github.com/iiasa/message_ix](https://github.com/iiasa/message_ix).

The [MESSAGEix Documentation](http://messageix.iiasa.ac.at/) includes a comprehensive description of all the sets, parameters, variables, constraints and equations of the model.
The Indus-Basin model fully relies on this framework with the addition of few parameters and variable that help addressing some mode specific issues.

## Water energy nexus parameters
|	Parameters	|	Label	|
|	---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|	---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|
|	water_consumption(tec)	|	Water consumed per energy produced	|



# Example

In this section a small example is used to explain how these work in the model. Figure 3 shows how the demand for 0.1 units of lighting in spatial unit Node A is met using electrcitiy produced by a coal power plant also in Node A. The coal needed for this production is transported from Node B where the coal is assumed to be available. In addition to raw coal, the power plant also required water for cooling, which is extracted from surface water SW and then purified onsite to the required quality. Because the water extraction and purification processes consume energy, overall additional energy is needed. The additional energy needs in turn also feedback to the water system, until a balance is met.

<br><br>

<p id="figcap"> Figure 3: Example of water and energy resource flows from extraction to final use</p>
<center>
<div id="fig">
![](figures\f_model_resourceflowExample.PNG)
</div>
</center>

<br><br>

For each technology an "input"" parameter defines the amount of commodity of a certain level that goes into the technology and then an "output"" parameter defines the amount of commodity of a certain level which is subsequently produced. These parameters are used to define the efficiency of the processes as well as spatial and temporal transfers. The overall goal of the model is to meet the demand for a commodity of a certain level for each node and time period defined by the parameter "demand". The table below shows the "input" and "output" parameters defined for different commodities of different levels for each technology process from the example from Figure 4. The column labelled "Activity" is the optimal activity of each technology. As seen in the table for the technology "Coal trans" we can use different "Nodes" to define processes which transfer a commodity by taking inputs at one node and producing an output at another node. Furthermore, the energy technologies defined here all have an efficiency of 100% i.e. they take in a commodity of 1 unit and produce a commodity of 1 unit without any losses. Efficiencies can be defined by making the inputs greater than the outputs. With this efficiency, in theory, the demand for 0.1 units of lighting would be met with 0.1 units of electricty, produced from 0.1 units of coal. However, because of the feedbacks with the water system and the corresponding requirements the energy demands of the whole system are slightly higher.

<br><br>

<p id="figcap"> Table: Water and energy input and output parameters for commodity flows through different technology processes for the example from Figure 3</p>
<center>
<div id="fig">
![](figures\t_model_resourceflowInputOutput.PNG)
</div>
</center>

<br><br>

A simplified form of the commodity balance equation can be defined as shown in the equation below where the variable "ACT", dictates how many units of "output" and "input" are processed for each commodity and level. The table that follows then shows how the balance is met for all the commodity transformations and levels from the example from Figure 3. Some commodity levels are excluded from the demand balance such as “insitu” resource volumes or resources which are released back into the environment such as “untreated” waste water. Insitu volumes are excluded because they are constrained in another equation based on the amount of resources available. Releases to the environment are excluded because they do not constrain the system. Any requirements for environmental flows are defined explicitly as a demand. 

<br><br>

<center>
<div id="box">
input\*ACT - output\*ACT + demand = 0 
</div>
</center>

<br><br>

<p id="figcap"> Table: Water and energy commodity balance for the example from Figure 3</p>
<center>
<div id="fig">
![](figures\t_model_resourceflowBalance.PNG)
</div>
</center>

<br><br>

## Indus Basin chosen tecs & comods

<strong>Figure 4</strong> below shows the chosen commodities and technologies for the Indus Basin model. The energy technologies are based on local capacity and classifications made by the IEA in their [energy statistics reports for Pakistan](https://www.iea.org/statistics/statisticssearch/report/?country=Pakistan&product=electricityandheat). Water technologies and commodities are based on previous models at IIASA and local data availability. At this stage the supply of products is classified in simplified groups which can later be further disaggregated to represent more detailed end-user technologies.

<br><br>

<p id="figcap"> Figure 4: Chosen technologies and commodities for Indus Basin model</p>
<center>
<div id="fig">
![](figures\f_model_indusTecsComs.PNG)
</div>
</center>

<br><br>

## Example run (Demo data only)

In this section the model is used to run a small example using a few actual PIDs (Polygon IDs) from the Indus Basin as shown in <strong>Figure 5</strong> below. PIDs 2229 and 2239 from Pakistan, 2249 from India and 2251 from Afghanistan are chosen. 

<br><br>

<p id="figcap"> Figure 5: Chosen PIDs in the Indus basin for example run</p>
<center>
<div id="fig">
![](figures\f_model_egrun_SelectedPIDs.PNG)
</div>
</center>

<br><br>

The conceptual framework of the demands and infrastructure considered is shown in <strong>Figure 6</strong>. It assumed that there is a demand for urban electricity in PID 2229 and a demand for Industrial electricity in PID 2251 in Afghanistan. There is a single coal power plant as well as a water processing plant located in PID 2229. Raw coal for the power plant is onnly available in PID 2249 while water is only available in PID 2239. Water extraction will also need additional energy in PID 2239 and the coal power plant in PID 2229 also requires water for power plant cooling. 

<br><br>

<p id="figcap"> Figure 6: Conceptual framework of infrastructure and demands</p>
<center>
<div id="fig">
![](figures\f_model_egrun_conceptualflows.PNG)
</div>
</center>

<br><br>

The following figures and paragraphs describe how the conceptual example from above is setup in the model. All inputs are managed in the <strong>aaaModelNew.xls</strong> excel file. <strong>Figure 7</strong> shows how the chosen PIDs are assigned in the model in the set "node" in the "sets" tab. The corresponding countries also need to be assigned in the set "map_spatial_hierarchy".

<br><br>

<p id="figcap"> Figure 7: Assigning spatial units in set "node" in "sets" tab in aaaModelNew.xls</p>
<center>
<div id="fig">
![](figures\f_model_egrun_setstab.PNG)
</div>
</center>

<br><br>

<strong>Figure 8</strong> shows an example of how different technology characteristics are defined using GAMS parameters in the "param_tec" tab. The figure shows the assignment of investment costs <strong>(inv_cost)</strong> for each technology, node and year. For this example to keep matters simple all technologies have been assigned the same cost for all nodes and years. This can of course be updated to reflect any differences in costs across borders and to account for forecasts in costs across years.

<br><br>

<p id="figcap"> Figure 8: Assigning technology parameters in "param_tec" tab in aaaModelNew.xls</p>
<center>
<div id="fig">
![](figures\f_model_egrun_paramTectab.PNG)
</div>
</center>

<br><br>

A separate tab ("param_tecInOut") in the excel sheet is reserved for assigning the flow of commodities through each technologies in the parameters <strong>input</strong> and <strong>output</strong>. <strong>Figure 9</strong> shows an example of these key parameters. Any technology can take in multiple inputs and produce different outputs. This allows the MESSAGE model to easily track flows of resource across sectors. For example if we zoom into the figure here we can see that the coal power plant <strong>e_conv_cntrl_ppl_coal</strong> located in PID 2229 take in both water and electrcitiy as an input and then outputs electrcity. Furthermore in this figure we can see that how transmission technologies are defined for each pair of spatial units.

<br><br>

<p id="figcap"> Figure 9: Assigning flows of commodities through technology parameters in "param_tecInOut" tab in aaaModelNew.xls</p>
<center>
<div id="fig">
![](figures\f_model_egrun_paramTecInOuttab.PNG)
</div>
</center>

<br><br>

<strong>Figure 10</strong> shows how resource availability and existing stocks of commodities are defined for each PID in the model, in the tab "param_res".

<br><br>

<p id="figcap"> Figure 10: Assigning resource availability per spatial units for each commodity "param_res" tab in aaaModelNew.xls</p>
<center>
<div id="fig">
![](figures\f_model_egrun_paramRestab.PNG)
</div>
</center>

<br><br>

<strong>Figure 11</strong> shows how exogenous demands for different commodities are defined in the model for spatial unit and year. In the current example as seen in the conceptual diagram in <strong>Figure 6</strong> a demand for urban electrcity is defined in PID 2229 and a demand for industrial electricity is defined in PID 2251. The greyed out country names are added for information.

<br><br>

<p id="figcap"> Figure 11: Assigning demands per spatial unit and commodity in "param_res" tab in aaaModelNew.xls</p>
<center>
<div id="fig">
![](figures\f_model_egrun_paramDemtab.PNG)
</div>
</center>

<br><br>


After the model has been setup as shown in the preceeding figures it can then be run either directly from GAMS or using R as a front end. <strong>Figure 12</strong> shows the GAMS project file <strong>message_project.gpr</strong> which contains the different GAMS runs. The model is run using the <strong>MESSAGE_masterExcel.gms</strong> file which reads the input excel sheet <strong>aaaModelNew.xls</strong> as well as calls all the other MESSAGE model gams files located in different folders. After the model runs the gdx file <strong>MSGOutput_Indus.gdx</strong> can be opened from the <strong>output</strong> folder. <strong>Figure 13</strong> shows a snapshot of the gdx file showing the variable ACT which shows the activity of each technology for each PID and vintage. 

<br><br>

<p id="figcap"> Figure 12: GAMS message_project.gpr</p>
<center>
<div id="fig">
![](figures\f_model_egrun_GAMSprj.PNG)
</div>
</center>

<br><br>

<p id="figcap"> Figure 13: GAMS MSGOutput_Indus.gdx file</p>
<center>
<div id="fig">
![](figures\f_model_egrun_GAMSoutGDX.PNG)
</div>
</center>

<br><br>

<strong>Figure 14</strong> shows an alternative way to run the model using R by opening the <strong>MESSAGEX.Rproj</strong> project folder which contains the <strong>MESSAGEX_Run.R</strong> file which is a front end which calls the GAMS files from before. R can be used to directly read the gdx output file and then process the results to create corresponding outputs. 

<br><br>

<p id="figcap"> Figure 14: RStudio project alternative</p>
<center>
<div id="fig">
![](figures\f_model_egrun_RProj.PNG)
</div>
</center>

<br><br>

<strong>Figure 15</strong> shows the conceptual framework with an overlay representing the model output for commodity flows across each technology. As can be seen in the current example there are no losses and total mass balance is maintained. In order to meet the total demand of 0.2 electricty units (0.1 urban electricty in PID 2229 and 0.1 industrial electricity in PID 2251) 0.25 units needed to be produced. This was because additional electricity was needed for the water purification unit as well as for the water extraction in PID 2239. The water was needed to cool the coal power plant in PID 2229. The example shows how the model can track the feedback across the sectors. 

<br><br>

<p id="figcap"> Figure 15: Model resource flow outputs overlay on conceptual figure</p>
<center>
<div id="fig">
![](figures\f_model_egrun_conceptualflowsResults.PNG)
</div>
</center>

<br><br>

<strong>Figure 16</strong> shows an example of outputs from an R script which reads the variable ACT, representing activity for each technology from the gdx file and can process it into figure for each PID and year. From the figure we can see the maximum activity is in PID 2229 which contains the coal powerplant, the water purification unit and the urban demand. PID 2239 has some activity related to water extraction involving water pumping and canal transfers and some electricty usage for the water processes. PID 2249 shows activity related to extracting and transporting raw coal and PID 2251 has activity related to electricty distribution and final supply of electricty to industries.

<br><br>

<p id="figcap"> Figure 16: Model outputs for Variable ACT per PID and tec</p>
<center>
<div id="fig">
![](figures\f_model_egrun_modelResultsChart.PNG)
</div>
</center>
